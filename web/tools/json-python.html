<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>JSON → Python (pydantic) • DevTools</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="container page">
      <div class="header">
        <a class="brand" href="/"><span class="dot"></span> DevTools</a>
      </div>
      <h1>JSON → Python Class (pydantic)</h1>
      <div class="two">
        <div class="field">
          <div class="label">JSON</div>
          <textarea
            id="json"
            class="code"
            placeholder='{"id":1,"name":"Alice","tags":["a","b"],"meta":{"ok":true}}'
          ></textarea>
          <div class="row">
            <input
              id="name"
              class="input"
              placeholder="Root name (default: Root)"
              style="max-width: 280px"
            /><button class="btn" id="gen">Generate</button>
          </div>
        </div>
        <div class="field">
          <div class="label">Python</div>
          <textarea id="out" class="code" style="min-height: 340px"></textarea>
          <div class="row">
            <button class="btn ghost" id="copy">Copy</button>
          </div>
        </div>
      </div>
      <div class="small" id="err"></div>
    </div>
    <div class="toast"></div>
    <script src="/app.js"></script>
    <script>
      function T(s) {
        return s
          .replace(/(^|_|-|\s)+(\w)/g, (_, a, b) => b.toUpperCase())
          .replace(/[^A-Za-z0-9]/g, "");
      }
      function snake(s) {
        return s
          .replace(/[^A-Za-z0-9]+/g, "_")
          .replace(/([a-z0-9])([A-Z])/g, "$1_$2")
          .toLowerCase();
      }
      function typeOf(v, name, defs) {
        if (v === null) return "Any";
        if (Array.isArray(v)) {
          if (v.length === 0) return "List[Any]";
          const ts = [...new Set(v.map((x) => typeOf(x, name, defs)))];
          return ts.length === 1
            ? `List<${ts[0]}>`.replace("<", "[").replace(">", "]")
            : "List[Any]";
        }
        switch (typeof v) {
          case "string":
            return "str";
          case "number":
            return Number.isInteger(v) ? "int" : "float";
          case "boolean":
            return "bool";
          case "object":
            return makeClass(v, name, defs);
          default:
            return "Any";
        }
      }
      function makeClass(obj, name, defs) {
        const className = T(name || "Root");
        if (defs[className]) return className;
        const fields = Object.entries(obj).map(([k, val]) => {
          const py = snake(k);
          const t = typeOf(val, k, defs);
          return { name: py, type: t, json: k };
        });
        defs[className] = fields;
        return className;
      }
      function render(defs, root, rootName) {
        let s =
          "from __future__ import annotations\nfrom typing import Any, List, Optional\nfrom pydantic import BaseModel\n\n";
        for (const [name, fields] of Object.entries(defs)) {
          s += `class ${name}(BaseModel):\n`;
          for (const f of fields) {
            s += `    ${f.name}: ${f.type}\n`;
          }
          s += "\n";
        }
        s += `\n# Root alias\n${rootName} = ${root}\n`;
        return s;
      }
      $("#gen").onclick = () => {
        try {
          const obj = JSON.parse($("#json").value);
          const rootName = T($("#name").value || "Root");
          const defs = {};
          const root = typeOf(obj, rootName, defs);
          $("#out").value = render(defs, root, rootName);
          $("#err").textContent = "";
        } catch (e) {
          $("#err").textContent = "Invalid JSON";
        }
      };
      $("#copy").onclick = () => copyText($("#out"));
    </script>
  </body>
</html>
