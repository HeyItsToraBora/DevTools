<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Markdown → PDF • DevTools</title>
    <link rel="stylesheet" href="/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  </head>
  <body>
    <div class="container page">
      <div class="header">
        <a class="brand" href="/"><span class="dot"></span> DevTools</a>
      </div>
      <h1>Markdown → PDF</h1>
      <div class="two">
        <div class="field">
          <div class="label">Markdown</div>
          <textarea
            id="md"
            class="code"
            placeholder="# Title\nContent..."
            style="min-height: 320px"
          ></textarea>
          <div class="row">
            <button class="btn" id="gen">Generate PDF</button>
          </div>
        </div>
        <div class="field">
          <div class="label">Preview (HTML)</div>
          <div
            id="prev"
            style="
              min-height: 320px;
              border: 1px solid var(--border);
              border-radius: 8px;
              padding: 12px;
              background: #0b1322;
            "
          ></div>
        </div>
      </div>
    </div>
    <div class="toast"></div>
    <script src="/app.js"></script>
    <script>
      function mdToHtml(md) {
        let h = md;
        h = h
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
        h = h.replace(/^######\s?(.*)$/gim, "<h6>$1</h6>");
        h = h.replace(/^#####\s?(.*)$/gim, "<h5>$1</h5>");
        h = h.replace(/^####\s?(.*)$/gim, "<h4>$1</h4>");
        h = h.replace(/^###\s?(.*)$/gim, "<h3>$1</h3>");
        h = h.replace(/^##\s?(.*)$/gim, "<h2>$1</h2>");
        h = h.replace(/^#\s?(.*)$/gim, "<h1>$1</h1>");
        h = h.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
        h = h.replace(/\*(.*?)\*/g, "<em>$1</em>");
        h = h.replace(/`([^`]+)`/g, "<code>$1</code>");
        h = h.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1<\/a>');
        h = h.replace(/\n\n/g, "</p><p>");
        return "<p>" + h + "</p>";
      }
      function plain(md) {
        return md.replace(/[#*_`\[\]]/g, "");
      }
      $("#md").oninput = () => {
        $("#prev").innerHTML = mdToHtml($("#md").value);
      };
      $("#gen").onclick = () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: "pt", format: "a4" });
        const margin = 40;
        const max = 515;
        const text = plain($("#md").value);
        const lines = doc.splitTextToSize(text, max);
        let y = margin;
        doc.setFont("helvetica", "normal");
        for (const line of lines) {
          if (y > 800) {
            doc.addPage();
            y = margin;
          }
          doc.text(line, margin, y);
          y += 16;
        }
        doc.save("document.pdf");
      };
    </script>
  </body>
</html>
